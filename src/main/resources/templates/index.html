<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>EC2 ë°°í¬ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Spring Boot on EC2</h1>
    </div>
    <div class="content">
        <div class="card success">
            <h2 th:text="${message}">ë°°í¬ ì„±ê³µì¸ê°€ìœ ?</h2>
        </div>
        <div class="card info">
            <h3>ì„œë²„ ì •ë³´</h3>
            <ul>
                <li>
                    <strong>í˜„ì¬ ì‹œê°„: </strong>
                    <span th:text="${currentTime}">í˜„ì¬ì‹œê°„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</span>
                </li>
                <li>
                    <strong>ì„œë²„ í™˜ê²½: </strong>
                    <span th:text="${serverInfo}">ì„œë²„í™˜ê²½ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</span>
                </li>
            </ul>
        </div>

        <!--ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ ì¹´ë“œ-->
        <div class="card info">
            <h3>ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°</h3>
            <ul>
                <li><strong>ìƒíƒœ:</strong> <span th:text="${dbStatus}"></span></li>
                <li><strong>DB:</strong> <span th:text="${dbName}"></span></li>
                <li><strong>URL:</strong> <span th:text="${dbUrl}" style="font-size: 0.85em; word-break: break-all;"></span></li>
            </ul>
        </div>

        <!--ê²Œì‹œê¸€ DB í…ŒìŠ¤íŠ¸ ì¹´ë“œ-->
        <div class="card">
            <h3>ğŸ“‹ ê²Œì‹œê¸€ DB í…ŒìŠ¤íŠ¸</h3>
            <!--AJAX /board APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²Œì‹œê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜´-->
            <button onclick="loadBoards()" class="button">ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <div id="board-list" style="margin-top: 20px">
                <p style="color: #666;">ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ DBì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</p>
            </div>
        </div>

        <div class="footer">
            <p>2025 EC2 Test Application | Spring Boot 3.5.7</p>
        </div>
    </div>

    <script>
        function loadBoards(){

                const boardList = document.getElementById('board-list');
                boardList.innerHTML = `<p>âŒ› ë¡œë”© ì¤‘....</p>`

                // Fetch APIë¡œ GET ìš”ì²­ ì „ì†¡
                fetch('/boards')
                .then(response => {
                     // HTTP ì‘ë‹µ  ìƒíƒœ í™•ì¸ (200ë²ˆëŒ€ê°€ ì•„ë‹ˆë©´ ì—ëŸ¬)
                    if(!response.ok){
                        throw new Error('HTTP ' + response.status)
                    }
                    return response.json();     // json í˜•íƒœë¡œ íŒŒì‹±
                })
                .then(data => {
                    // ë°ì´í„°ê°€ ë¹„ì–´ìˆëŠ” ê²½ìš° ì²˜ë¦¬
                    if(data.length == 0){
                        boardList.innerHTML = `<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>`
                    } else {
                        // ê²Œì‹œê¸€ ëª©ë¡ HTML ìƒì„± ì‹œì‘
                        let html = '<p style="color: #28a745; font-weight:bold;">DB ì—°ë™ ì„±ê³µ! ì´ ' + data.length + 'ê°œì˜ ê²Œì‹œê¸€</p>';

                        html += '<div style="max-height: 400px; overflow-y: auto;">'    // ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì˜ì—­

                        // ê° ê²Œì‹œê¸€ì„ ìˆœíšŒí•˜ì—¬ HTML ìƒì„±
                        data.forEach((board, index) => {    // board: ê²Œì‹œê¸€ ê°ì²´, index: ë°°ì—´ ìˆœë²ˆ(0ë¶€í„° ì‹œì‘)
                            html += '<div style="border: 1px solid #ddd; padding: 12px; margin: 10px 0; border-radius: 5px; background: #f8f9fa;">';
                            html += '<div style="color: #666; font-size: 0.9em;">ê²Œì‹œê¸€ #' + (index +1) + ' (ID: ' + board.id + ')</div>';
                            html += '<div style="font-weight: bold; margin: 5px 0;">' +board.title + '</div>';
                            html += '<div style="color: #555;">' +board.content + '</div>';

                            html += '</div>';

                        });



                        html += '</div>'



                        boardList.innerHTML = html;
                    }
                })
                .catch(error => {
                    boardList.innerHTML = '<p style="color: red;">âŒ ì—ëŸ¬ ë°œìƒ: ' + error.message + '</p>';
                })
            }

    </script>

</div>

</body>
</html>